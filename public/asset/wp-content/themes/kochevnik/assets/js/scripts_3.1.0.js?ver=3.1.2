(function ($, root, undefined) {

  $(function () {

    'use strict';


    // Site's height not less than window's height
    $(document).ready(function(){
      var hh = $('header').height();
      var fh = $('footer').height();
      var wh = $(window).height();
      var сh = wh - hh - fh;
      $('main').css('min-height', сh);
    });

    $('#main-slider').owlCarousel({
      items: 1,
      autoplay: true,
      smartSpeed: 400,
      loop: true,
      nav: true,
      autoplayTimeout: 70000
    });

    $('#sel-offers').owlCarousel({
      items: 1,
      autoplay: true,
      smartSpeed: 400,
      loop: true,
      dots: false,
      nav: true,
    });

    $('#selections-slider').owlCarousel({
        autoplay: true,
        smartSpeed: 400,
        touchDrag: true,
        margin: 10,
        nav: true,
        responsive: {
          0 : {
            items: 1,
          },
          768 : {
            items: 2,
          },
          1023 : {
            items: 3,
          },
        }
    });

    $('#partners').owlCarousel({
        items: 5,
        loop: true,
        autoplay: true,
        smartSpeed: 400,
        margin: 10,
    });

    $('#countries-select').select2({
      placeholder: "Страна",
      allowClear: true,
      "language": {
       "noResults": function(){
           return "Не найдено";
           }
       },
    });

    $('#rest-select').select2({
      placeholder: "Тип отдыха",
      allowClear: true,
      "language": {
       "noResults": function(){
           return "Не найдено";
           }
       },
    });

    $('#hotel-stars').select2({
      allowClear: true,
      placeholder: "Звездность",
    });

    $('.header-mobile__phone').on('click', function () {
        ym(32440970, 'reachGoal', 'CALL');
    });

    $('.fm-links__btn--phone').on('click', function () {
        ym(32440970, 'reachGoal', 'CALL');
    });

    $('.fm-links__btn--wa').on('click', function () {
        ym(32440970, 'reachGoal', 'WHATSAPP');
    });

    $('#js-show-form-btn').click( function() {
      var form = $('#find-tour-form');

      if ( form.is(':hidden') ) {
        form.slideDown();
        $(this).html('Свернуть');
      } else {
        form.slideUp();
        $(this).html('Заполнить заявку');
      }
    });

    // mobile navigation
    $('.js-btn-menu-toggle').click( function(e) {
      var nav = $('#mobile-nav');
      e.stopPropagation();

      if (nav.hasClass('active')) {
        // $(this).removeClass('active');
        nav.removeClass('active');
        $('body').removeClass('no-scroll');
      } else {
        $('#header-contacts').removeClass('active');
        $('#header-menu').removeClass('active');
        $('.header-mobile__btn').removeClass('active');
        // $(this).addClass('active');
        nav.addClass('active');
        $('body').addClass('no-scroll');
      }
    });

    // subscribe form
    $('#subscribe input:checkbox').change( function(){
      var row = $(this).parents('.form__row');

      if ($(this).is(':checked')) {
          if ( !row.find('.subs-input').is(':visible') ) {
            row.find('.subs-input').slideDown();
          }
      } else {
        if (row.find('input:checked').length == 0) {
          row.find('.subs-input').slideUp();
        }
      }

      if ($('#subscribe').find('input:checked').length > 0) {
        $('#subscribe').find('.form__btn').fadeIn();
      } else {
        $('#subscribe').find('.form__btn').fadeOut();
      }
    });

    $('.form-steps-nav__item').click(function(){
      var index = $( this ).index();
      var selected = $('#country-select option:selected');

      $('.form-steps-nav__item').removeClass('done');


      if ( selected.val() ) {
        if (index === 2) {

          if ($('.form-step .form-when').val()) {
            $('.form-steps-nav__item').addClass('done');
            $('.form-step').hide().eq(index).show();
          }
        } else {
          $(this).addClass('done');
          $('.form-step').hide().eq(index).show();
        }

      } else {
        $('#select2-country-select-container').css('border-color', 'red');
      }
    });

    $('.add-services__more-btn').click(function(){
      var desc = $(this).parents('.add-services__item').find('.add-services__desc');

      if( desc.is(":hidden") ) {
        desc.slideDown();
        $(this).html('Свернуть').addClass('active')
      } else {
        desc.slideUp();
        $(this).html('Подробнее').removeClass('active')
      }
    });


    $('.b24-web-form-popup-btn-11').magnificPopup({
      items: [
        {
          src: '#uon-form-popup', // CSS selector of an element on page that should be used as a popup
          type: 'inline'
        }
      ],
    });

    document.addEventListener( 'wpcf7mailsent', function( event ) {
      location = 'https://kochevnik.kg/thank-you';
    }, false );

    // video player
    if ( $('.video-block').length >= 1 ) {
      var videoCont = $('.video-block');

      videoCont.each(function() {
        if ( !$(this).attr('style') ) {
          var videoId   = $(this).attr('data-video');
          var videoUrl = 'url(https://img.youtube.com/vi/' + videoId + '/maxresdefault.jpg)';
          $(this).css({
            'background-image': videoUrl,
          });
        }
      })
    };

    $('.video-block').click(function(){
      if ( !$(this).hasClass('active') ) {
        var video = '<iframe src="https://www.youtube.com/embed/' + $(this).attr('data-video') + '?autoplay=1" allowfullscreen></iframe>';
        removeVideo();
        $(this).addClass('active');
        $(this).append(video);
      }
      return false;
    });

    function removeVideo(event) {
      $('.video-block').each(function() {
        $(this).find('iframe').remove();
        $(this).removeClass('active');
      });
    };

    // countdown
    if( $("#countdown").length>0 ) {
      $("#countdown").countdown();
    }

    $('.tour-loop__more-btn').click( function(e) {
      e.stopPropagation();
      var article = $(this).parents('.tour-loop');
      var content = article.find('.tour-loop__content');

      if( !content.hasClass('active') ) {
        content.addClass('active');
        $('body').addClass('no-scroll');
      } else {
        content.removeClass('active');
        $('body').removeClass('no-scroll');
      }
    });

    $('.tour-loop__content').click(function(e) {
      e.stopPropagation();
    });

    $('html').on( 'click', '.no-scroll', function(e) {
      e.preventDefault();
      $('.tour-loop__content').removeClass('active');
      $(this).removeClass('no-scroll');
    });

    // page navigation
    if( $('body').hasClass('single-countries') ) {
      var list = '<ul class="article-menu">';
      $('.article__subhead').each( function() {
        list += '<li class="article-menu__item">' + $(this).html() + '</li>';
      });

      list += '</ul>';

      $('#article-nav').append(list);
    }

    // pop up
    $('.form-message__btn').click(function(){
      var block = $(this).parents('.form-message');

      if (block.is(':visible')) {
        block.removeClass('shown');
        $('.js-crmtronic-lead-form').find('textarea, :text, select').val('').end().find('.form-persons').val(1).end().find('.form-children').val(0);
        $.magnificPopup.close();
      }
    });

    // inline
    $('.js-pop-up-btn').magnificPopup({
        type:'inline',
        callbacks: {
          beforeOpen: function() {
            this.st.mainClass = 'mfp-zoom-in';
            var button        = this.st.el;
            var popup         = $(button.attr('href'));
            var popup_wrap    = popup.find('.popup__wrap');
            // var form_head     = button.data('head');
            var form_desc     = button.data('desc');

            if (button.data('desc')) {
              popup_wrap.prepend('<div class="popup__desc">' + button.data('desc') + '</div>');
            }

            if (button.data('head')) {
              popup_wrap.prepend('<div class="popup__head">' + button.data('head') + '</div>');
              popup.find('input[name=form-name]').val(button.data('head'));
            }
          },
          beforeClose: function() {
            var button = this.st.el;
            var popup  = $(button.attr('href'));

            popup.find('.popup__head').remove();
            popup.find('.popup__desc').remove();
          }
        },
    });

    // gallery
    $('.gallery').magnificPopup({
        delegate: 'a',
        type: 'image',
        gallery: {
          enabled:true
        },
        callbacks: {
          beforeOpen: function() {
             this.st.mainClass = 'mfp-zoom-in';
          }
        },
    });

    $('.match-height').matchHeight();

    var page = $("html, body");

    $('#article-nav').on('click', 'li', function() {
      var index = $( this ).index();

      page.on("scroll mousedown wheel DOMMouseScroll mousewheel keyup touchmove", function(){
        page.stop();
      });

      $('html,body').animate({scrollTop: $('.article__subhead').eq(index).offset().top - 20},'slow', function(){
        page.off("scroll mousedown wheel DOMMouseScroll mousewheel keyup touchmove");
      });
    });

    $('body').on('click', '.btn-scroll', function() {
      var blockId = $(this).attr('href');

      $('html,body').animate({scrollTop: $(blockId).offset().top},'slow', function(){
        page.off("scroll mousedown wheel DOMMouseScroll mousewheel keyup touchmove");
      });
    });

    // PickMeUp localization
    pickmeup.defaults.locales['ru'] = {
      days: ['Воскресенье', 'Понедельник', 'Вторник', 'Среда', 'Четверг', 'Пятница', 'Суббота'],
      daysShort: ['Вс', 'Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб'],
      daysMin: ['Вс', 'Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб'],
      months: ['Январь', 'Февраль', 'Март', 'Апрель', 'Май', 'Июнь', 'Июль', 'Август', 'Сентябрь', 'Октябрь', 'Ноябрь', 'Декабрь'],
      monthsShort: ['Янв', 'Фев', 'Мар', 'Апр', 'Май', 'Июн', 'Июл', 'Авг', 'Сен', 'Окт', 'Ноя', 'Дек']
    };

    pickmeup('input.form-date1', {
      hide_on_select : true,
      default_date : false,
      locale : 'ru',
      format  : 'd.m.Y',
    });

    pickmeup('input.form-date2', {
      hide_on_select : true,
      default_date : false,
      locale : 'ru',
      format  : 'd.m.Y',
    });
    pickmeup('input.form-dates', {
      mode      : 'range',
      default_date : false,
      locale : 'ru',
      hide_on_select : true,
    });

      // Magnific popup translation

    $.extend(true, $.magnificPopup.defaults, {
      tClose: 'Закрыть (Esc)',
      tLoading: 'Загрузка...',
      gallery: {
        tPrev: 'Назад (Клавиша влево)',
        tNext: 'Вперед (Клавиша вправо)',
        tCounter: '%curr% из %total%'
      },
      image: {
        tError: '<a href="%url%">Картинка</a> не загрузилась.'
      },
      ajax: {
        tError: '<a href="%url%">Содержимое</a> не загрузилось.'
      }
    });

  });

})(jQuery, this);
